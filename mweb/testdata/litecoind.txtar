env P2P_PORT=19555

# Start litecoind
exec mkdir $WORK/litecoin
exec litecoind -datadir=$WORK/litecoin -regtest -port=$P2P_PORT &
litecoin-cli -rpcwait -rpcwaittimeout=5 createwallet test

# Start lnd
exec lnd --litecoin.active --litecoin.node=neutrino --litecoin.regtest --lnddir=$WORK/lnd --rpclisten=127.0.0.1:$LND_RPC_PORT --neutrino.addpeer=127.0.0.1:$P2P_PORT &
openRpcConn $WORK/lnd 0
createWallet
openRpcConn $WORK/lnd 1

# Generate pre-MWEB blocks
litecoin-cli -generate 431
syncToBlock 431

# Send pegin transaction
litecoin-cli getnewaddress '' mweb
getResult LITECOIND_MWEB_ADDR
litecoin-cli sendtoaddress $LITECOIND_MWEB_ADDR 1
litecoin-cli -generate 1
syncToBlock 432

# Send to lnd
newAddress mweb
getResult LND_MWEB_ADDR
litecoin-cli sendtoaddress $LND_MWEB_ADDR 100
litecoin-cli -generate 1
syncToBlock 433

# Verify that lnd received coins
waitForUtxos 1
checkUtxo 0 $LND_MWEB_ADDR 100
